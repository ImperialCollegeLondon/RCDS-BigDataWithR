{
  "name": "RStudio Codespace",
  // Use a base image. Debian or Ubuntu are good choices.
  // You could also explore Rocker project images (ghcr.io/rocker-org/devcontainer/r-ver)
  // but this example uses a generic base for broader applicability.
  //"image": "mcr.microsoft.com/devcontainers/base:ubuntu", // Or :debian
  "image": "rocker/binder:4.3",
  "containerUser": "root",

  // Disable RStudio login and ensure RStudio knows who the user is
  "containerEnv": {
    "DISABLE_AUTH": "true",        // helpful if Rocker's init handles it
    "USER": "rstudio"              // required when auth is disabled
  },

  "settings": {
    "extensions.ignoreRecommendations": true,
    "git.enableSmartCommit": true,
    "git.confirmSync": false,
    "git.autofetch": true,
    "git.rebaseWhenSync": true
  },


  "features": {
    "ghcr.io/rocker-org/devcontainer-features/r-packages:1": {
        "packages": "languageserver,httpgd,dplyr,dtplyr,data.table,sparklyr"
    },
    "ghcr.io/rocker-org/devcontainer-features/quarto-cli:latest": {
      "installTinyTex": "false"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "reditorsupport.r",
        "ms-toolsai.jupyter",
        "jaydesl.vscode-r-arrow",
        "LiamJianliangGao.comment-toggle"
      ]
    }
  },

// Install RStudio Server, create user, set configs
  "postCreateCommand": "/bin/bash -c 'apt-get update && apt-get install -y --no-install-recommends wget gdebi-core ca-certificates && wget -O /tmp/rstudio-server.deb https://download2.rstudio.org/server/jammy/amd64/rstudio-server-2025.05.1-513-amd64.deb && gdebi -n /tmp/rstudio-server.deb && rm -f /tmp/rstudio-server.deb && id -u rstudio >/dev/null 2>&1 || useradd -m -s /bin/bash -u 1000 rstudio && echo rstudio:rstudio | chpasswd || true && printf \"auth-none=1\\nwww-address=0.0.0.0\\n\" > /etc/rstudio/rserver.conf && printf \"session-default-working-dir=/workspaces/RCDS-BigDataWithR\\nsession-default-new-project-dir=/workspaces/RCDS-BigDataWithR\\n\" > /etc/rstudio/rsession.conf && chown -R rstudio:rstudio /workspaces/RCDS-BigDataWithR || true && rstudio-server start && runuser -u rstudio -- Rscript -e \"options(timeout=1200); sparklyr::spark_install(version = \\\"2.4\\\", hadoop_version = \\\"2\\\")\" || echo \\\"spark_install failed; continuing\\\" '",


  "postStartCommand": "rstudio-server restart || rstudio-server start",
  
  // NEW: forward RStudio port
  "forwardPorts": [8787],
  "portsAttributes": {
    "8787": {
      "label": "RStudio",
      "protocol": "http",
      "onAutoForward": "ignore",
      "visibility": "private"
    }
  }
}